[
  {
    "type": "function",
    "function": {
      "name": "extract_metrics",
      "parameters": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "original_metrics": {
            "type": "array",
            "additionalProperties": false,
            "description": "Read through the entire text, analyze it line by line, and extract sentences",
            "items": {
              "type": "object",
              "properties": {
                "sentence": {
                  "type": "string",
                  "description": "The sentence MUST contain business or financial percentage changes (including descriptions such as “growth, decline, YoY, quarter-over-quarter, %, two-digit, double-digit, three-digit, triple-digit” etc.)."
                },
                "speaker": {
                  "type": "string",
                  "description": "Name of the speaker who mentioned the sentence."
                },
                "paragraph_number": {
                  "type": "integer",
                  "description": "Paragraph number in the transcript where the sentence is mentioned."
                }
              },
              "required": ["sentence", "speaker", "paragraph_number"]
            }
          },
          "processed_metrics": {
            "type": "array",
            "additionalProperties": false,
            "description": "Infer the `name`, `direction`, and `reason` based on the `original_metrics`. `processed_metrics` array **must ensure a strict one-to-one correspondence** with the `original_metrics` array",
            "items": {
              "type": "object",
              "properties": {
                "sentence": {
                  "type": "string",
                  "description": "Copy the `sentence` field from the corresponding `original_metrics` item exactly (this ensures matching)."
                },
                "speaker": {
                  "type": "string",
                  "description": "Copy the `speaker` field from the corresponding `original_metrics` item exactly (this ensures matching)."
                },
                "paragraph_number": {
                  "type": "integer",
                  "description": "Copy the `paragraph_number` field from the corresponding `original_metrics` item exactly (this ensures matching)."
                },
                "name": {
                  "type": "string",
                  "description": "Based on the extracted `sentence` from the `original_metrics`, summarize the metric name."
                },
                "direction": {
                  "type": "string",
                  "enum": ["up", "down", "unchanged"],
                  "description": "Based on the extracted `sentence` from the `original_metrics`, infer the `direction` of this change (\"up\", \"down\", or \"unchanged\")."
                },
                "reason": {
                  "type": "string",
                  "description": "Based on the extracted `sentence` from the `original_metrics`, infer the `reason` behind this change. The reason should be derived from the full transcript and use management’s own wording. If management does not mention any reason, return an empty string."
                }
              },
              "required": ["sentence", "speaker", "paragraph_number", "name", "direction", "reason"]
            }
          }
        },
        "required": ["original_metrics", "processed_metrics"]
      }
    }
  }
]
